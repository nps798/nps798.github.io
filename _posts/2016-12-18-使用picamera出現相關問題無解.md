--- 
bg: "rails.jpg" 
layout: post 
title: 使用picamera出現相關問題無解 
summary: "弄了兩天依然無解" 
date: 2016-12-18 
categories: posts 
tags: [''] 
author: nps798 
---

吐苦水zzz.....最近買了picamera(相機模組)想來實作Raspberry Pi 3的監視器系統，無奈這幾天測試串流成功後，許多無解的問題又出現了。所以這篇是一個廢文，統計一下目前我遇過的bug....
 
以下為示意圖，並不是我購買的Picamera。

[https://c1.staticflickr.com/3/2827/9367415640_c3e6c42e10_z.jpg]() 
 

## ENOSPC 問題

發生時機：
- raspivid 執行時 ...
- raspivid 執行出現問題後，再去執行 raspistill ..

錯誤訊息全文：
{% highlight linenos %} mmal: mmal_vc_component_enable: failed to enable component: ENOSPC
mmal: camera component couldn't be enabled
mmal: main: Failed to create camera component
mmal: Failed to run camera app. Please check for firmware updates
{% endhighlight %} 
 
網路上不管是 github 或是 Stack Overflow 或是 Raspberry pi 官方論壇都有很多人討論這問題，似乎這問題已經從2013一路出現至今(orz....)，過去有很多奇怪解法，例如blacklist、修改 /etc/modules....不過似乎都不是universal的解法。

我的觀察是這一兩年這類問題好像比較少，而且最近這幾年有問這問題的最後回答大多是請他們更新raspberry pi，也許是 rpi-update 解決了這方面的硬體驅動問題？！

這方面我也無法提供回答，因為我個人的情況就是那更新之後還是出現bug的....囧，我猜是可能跟我 picamera並非原廠的這件事情有關係。我的推測是：這個問題在2016等新版pi,picamera已經解決，只是我的相機模組是舊的picamera類型的架構，因此即使新版軟體方面解決了，我還是沒辦法使用。


## no data received from sensor 問題

這問題簡單，最後發現都是相機傳訊線沒有接好...請各位看網路教學，對好接口方向！


## picamera.exc.PiCameraMMALError 問題

發生點：
- 使用 python picamera library 去實作網路mjpeg streaming

錯誤訊息：
{% highlight linenos %} picamera.exc.PiCameraMMALError: Failed to enable connection: Out of resources (other than memory)
{% endhighlight %} 

這個錯誤訊息只發生在picamera方面，但我覺得跟第一個ENOSPC問題如出一徹，都是背後的軟體、軟硬體之間驅動問題有關。順道一提，我使用這邊的python程式碼[https://gist.github.com/nioto/9343730](https://gist.github.com/nioto/9343730)他只能一個client觀看mjpeg直播，未來還要修改這程式碼！


## 幾個小觀察

1.執行raspivid就會出現問題，但是昨天晚上我用 raspivid 直播了一整晚都沒事，不知道為什麼今天就有問題。另外，執行raspivid之後，就不能使用picamera(python)、raspstill了

2.一開機使用 picamera可以直播，而且可以播很久沒問題。但只要把python關掉重開，就會出現picamera.exc.PiCameraMMALError。

3.一開幾使用raspistill 可以一直用沒關係，都不會出現錯誤（除非做過上面二點所提動作）



## 並非 gpu memory 不夠的問題

網路上有人提出過是 gpu memory 不足，或 memory split 不足的問題。但我試過，把mem調高，還是不行。這跟網路上許多網友的經驗一致。現在大概認為，這是軟體方面的問題。
 
 
## 結論

若您使用picamera有上述之問題，請記得更新apt-get update, apt-get upgrade, rpi-update，還有開啟 raspi-config中的 camera，如果還是不行就.....祝你一路順風拉ＱＱＱ

我的下一步應該是在買一塊板子跟原廠鏡頭來交叉測試看看zzz
